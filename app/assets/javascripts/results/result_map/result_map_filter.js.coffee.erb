ToMarkers = ($rootScope) ->
  (providers) ->
    if providers
      for provider, index in providers
        providers[index]['isIconVisibleOnClick'] = true
        providers[index]['closeClick'] = 'none'

        # this to prevent the digest loop to go crazy
        unless providers[index]['coords']
          for address in provider.addresses
            if address.type == "Physical Address" and address.status == "Active"
              providers[index]['coords'] = "37.7313399,-122.3933311" # address.latitude + "," + address.longitude

        if providers[index].typeOfCare == "Child Care Center"
          providers[index]['gmap_icon'] = "fa-building"
          providers[index]['gmap_icon_title'] = "Child Care Center"
          providers[index]['display_address'] = provider.address.street1
          providers[index]['display_address'] += ' ' + provider.address.street2 if provider.address.street2
          unless providers[index]['options']
            providers[index]['options'] = {
              icon: '<%= image_path "facility_marker.png" %>'
            }
        else
          providers[index]['gmap_icon'] = "fa-home"
          providers[index]['gmap_icon_title'] = "Family Child Care"
          providers[index]['display_address'] = provider.cross_street_1 + ' & ' + provider.cross_street_2
          unless providers[index]['options']
            providers[index]['options'] = {
              icon: '<%= image_path "home_marker.png" %>'
            }

    return providers

ToMarkers.$inject = ['$rootScope']
angular.module('CCR').filter('toMarkers', ToMarkers)
